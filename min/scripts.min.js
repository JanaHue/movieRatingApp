var movieApp={api_key:"15b14981e921515511afd98345386c7c",init:function(){movieApp.grabConfig(),movieApp.getSessionId(),movieApp.grabUserSearch(),$("body").on("change","input[name*=rating]",function(){var e=$(this).val(),i=$(this).attr("id").split("-")[0].replace("movie","");movieApp.ratingHandler(e,i),console.log("You rated!")}),$("body").on("click",".movieImg",function(){var e=$(this).data("movieid");movieApp.grabDesc(e),$(".overlay").fadeIn()}),$(".overlay, .close").on("click",function(){$(".overlay").fadeOut()}),$("form.search").on("submit",function(e){e.preventDefault();var i=$("input[name=search]").val(),a=encodeURI(i);movieApp.grabUserSearch(a)})},grabDesc:function(e){var i="http://api.themoviedb.org/3/movie/"+e;$.ajax(i,{type:"GET",dataType:"jsonp",data:{api_key:movieApp.api_key},success:function(e){e.overview&&$(".overlay .overview p").text(e.overview),$(".overlay .overview h2").text(e.title)}})},grabConfig:function(){var e="http://api.themoviedb.org/3/configuration";$.ajax(e,{type:"GET",dataType:"jsonp",data:{api_key:movieApp.api_key},success:function(e){movieApp.config=e}})},grabUserSearch:function(e){var i="http://api.themoviedb.org/3/search/movie";$.ajax(i,{type:"GET",dataType:"jsonp",data:{api_key:movieApp.api_key,query:e},success:function(e){movieApp.displayMovies(e.results),$(".arrow").fadeIn()}})},displayMovies:function(e){$(".boxOffice").empty();for(var i=0;i<e.length;i++){{$("<h2>").text(e[i].title)}if(e[i].poster_path)var a=$("<img>").attr("src",movieApp.config.images.base_url+"w500"+e[i].poster_path);else var a=$("<img>").attr("src","i/ajax-loader.gif");var o=$("fieldset.rateMovie")[0].outerHTML;o=o.replace(/star/g,"movie"+e[i].id+"-star"),o=o.replace(/rating/g,"rating-"+e[i].id),movieImg=$("<div>").addClass("movieImg").attr("data-movieid",e[i].id),movieImg.append(a),movieWrap=$("<div>").addClass("movie"),movieWrap.append(movieImg,o),$(".boxOffice").append(movieWrap)}},ratingHandler:function(e,i){$.ajax("http://api.themoviedb.org/3/movie/"+i+"/rating",{type:"POST",data:{api_key:movieApp.api_key,guest_session_id:movieApp.session_id,value:2*e},success:function(e){e.status_code||alert(e.status_message)}})},getSessionId:function(){var e="http://api.themoviedb.org/3/authentication/guest_session/new";$.ajax(e,{data:{api_key:movieApp.api_key},type:"GET",dataType:"jsonp",success:function(e){movieApp.session_id=e.guest_session_id}})}};$(function(){movieApp.init()});